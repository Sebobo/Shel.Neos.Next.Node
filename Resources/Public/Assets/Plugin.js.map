{
  "version": 3,
  "sources": ["../../../ui-plugin/node_modules/@neos-project/neos-ui-extensibility/src/readFromConsumerApi.ts", "../../../ui-plugin/node_modules/@neos-project/neos-ui-extensibility/src/shims/vendor/react/index.js", "../../../ui-plugin/node_modules/@neos-project/neos-ui-extensibility/src/shims/vendor/react-redux/index.js", "../../../ui-plugin/node_modules/@neos-project/neos-ui-extensibility/src/shims/neosProjectPackages/neos-ui-redux-store/index.js", "../../../ui-plugin/node_modules/@neos-project/neos-ui-extensibility/src/shims/neosProjectPackages/react-ui-components/index.js", "../../../ui-plugin/node_modules/@neos-project/neos-ui-extensibility/src/shims/neosProjectPackages/neos-ui-decorators/index.js", "../../../ui-plugin/node_modules/@neos-project/neos-ui-extensibility/src/shims/vendor/redux-actions/index.js", "../../../ui-plugin/node_modules/@neos-project/neos-ui-extensibility/src/index.ts", "../../../ui-plugin/src/features/AddNextNodeToolBar.tsx", "../../../ui-plugin/src/features/Events.ts", "../../../ui-plugin/src/features/AddNextNodeToolBar.module.css", "../../../ui-plugin/src/features/CKEditorPlugin.ts", "../../../ui-plugin/src/actions/index.ts", "../../../ui-plugin/src/manifest.ts"],
  "sourcesContent": [null, null, null, null, null, null, null, null, "import React, { useMemo, useEffect, useCallback } from 'react';\nimport { connect } from 'react-redux';\n\nimport { selectors, actions } from '@neos-project/neos-ui-redux-store';\nimport { Button, Icon } from '@neos-project/react-ui-components';\nimport { neos } from '@neos-project/neos-ui-decorators';\n\nimport { CREATE_NEXT_NODE_EVENT } from './Events';\n\nimport style from './AddNextNodeToolBar.module.css';\n\nconst withReduxState = connect((state) => ({\n    node: selectors.CR.Nodes.focusedSelector(state),\n    getNodeByContextPath: selectors.CR.Nodes.nodeByContextPath(state)\n}), {\n    focusNode: actions.CR.Nodes.focus,\n    moveNodes: actions.CR.Nodes.moveMultiple\n});\n\nconst withNeosGlobals = neos((globalRegistry) => ({\n    nodeTypesRegistry: globalRegistry.get('@neos-project/neos-ui-contentrepository')\n}));\n\nconst withPermissionContext = (component: React.FC) => withNeosGlobals(\n    connect((_state, { nodeTypesRegistry }: { nodeTypesRegistry: NodeTypesRegistry }) => {\n        const getAllowedSiblingNodeTypesSelector = selectors.CR.Nodes.makeGetAllowedSiblingNodeTypesSelector(nodeTypesRegistry);\n\n        return (state) => {\n            const focusedNodeContextPath = selectors.CR.Nodes.focusedNodePathSelector(state);\n            const getNodeByContextPathSelector = selectors.CR.Nodes.makeGetNodeByContextPathSelector(focusedNodeContextPath);\n            const focusedNode = getNodeByContextPathSelector(state);\n\n            const role = focusedNode ? (nodeTypesRegistry.hasRole(focusedNode.nodeType, 'document') ? 'document' : 'content') : null;\n            const allowedSiblingNodeTypes = focusedNode ? getAllowedSiblingNodeTypesSelector(state, {\n                reference: focusedNodeContextPath,\n                role\n            }) : [];\n\n            return {\n                allowedSiblingNodeTypes,\n                isAllowedToAddChildOrSiblingNodes: allowedSiblingNodeTypes.length > 0\n            };\n        };\n    }, {\n        commenceNodeCreation: actions.CR.Nodes.commenceCreation\n    })(component));\n\ntype ComponentProps = {\n    contextPath: string;\n    fusionPath: string;\n    commenceNodeCreation: (contextPath: string, fusionPath: string, position: 'after' | 'before' | 'inside', nodeTypeName: string) => void;\n    isAllowedToAddChildOrSiblingNodes: boolean;\n    allowedSiblingNodeTypes: string[];\n    i18nRegistry: I18nRegistry;\n    node: CRNode;\n    nodeTypesRegistry: NodeTypesRegistry;\n};\n\nconst makeAddNextNodeToolbar = (pluginConfiguration: PluginOptions) => {\n    const AddNextNodeToolBar: React.FC<ComponentProps> = ({\n                                                              contextPath,\n                                                              fusionPath,\n                                                              commenceNodeCreation,\n                                                              isAllowedToAddChildOrSiblingNodes,\n                                                              allowedSiblingNodeTypes,\n                                                              i18nRegistry,\n                                                              node,\n                                                              nodeTypesRegistry\n                                                          }) => {\n\n        const nextNodeTypes: string[] = useMemo((): string[] => {\n            const nodeType = node ? nodeTypesRegistry.getNodeType(node.nodeType) : [];\n            let { nextNodeTypes } = nodeType.options;\n\n            // Filter out the next node types which are disabled or not allowed as sibling nodes\n            const nextNodeTypeCandidates = nextNodeTypes ? Object\n                .keys(nextNodeTypes)\n                .filter((nodeTypeName) => {\n                    return nextNodeTypes[nodeTypeName] && allowedSiblingNodeTypes.includes(nodeTypeName);\n                }) : [];\n\n            // Default to the current node type if no candidates for the next node type are available\n            return nextNodeTypeCandidates.length > 0 ? nextNodeTypeCandidates : [node.nodeType];\n        }, [node?.nodeType, allowedSiblingNodeTypes]);\n\n        // Callback to start the node creation process with the given node type already selected\n        const handleCommenceNodeCreation = useCallback((nodeTypeName: string) => {\n            commenceNodeCreation(\n                contextPath,\n                fusionPath,\n                'after',\n                nodeTypeName\n            );\n        }, [contextPath, fusionPath, commenceNodeCreation]);\n\n        useEffect(() => {\n            const contentWindow = document.querySelector('[name=\"neos-content-main\"]')?.contentWindow;\n\n            if (node.isAutoCreated || !contentWindow) {\n                return;\n            }\n\n            // Create a listener to create the first candidate node when the event is fired (e.g. by the CKEditor plugin)\n            const createFirstCandidateListener = (e: Event) => {\n                if (nextNodeTypes.length === 0) {\n                    return;\n                }\n                if (e.type === CREATE_NEXT_NODE_EVENT) {\n                    handleCommenceNodeCreation(nextNodeTypes[0]);\n                }\n                if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) {\n                    e.stopImmediatePropagation();\n                    e.preventDefault();\n                    handleCommenceNodeCreation(nextNodeTypes[0]);\n                }\n            };\n\n            contentWindow.addEventListener(CREATE_NEXT_NODE_EVENT, createFirstCandidateListener);\n            contentWindow.addEventListener('keydown', createFirstCandidateListener, true);\n\n            return () => {\n                contentWindow.removeEventListener(CREATE_NEXT_NODE_EVENT, createFirstCandidateListener);\n                contentWindow.removeEventListener('keydown', createFirstCandidateListener, true);\n            };\n        }, [contextPath, handleCommenceNodeCreation]);\n\n        return !node.isAutoCreated ? (\n            <div className={style.addNextNodeButtons} id=\"neos-InlineToolbar-AddNextNode\">\n                {nextNodeTypes.map((nodeTypeName: string) => {\n                    const nodeType = nodeTypesRegistry.getNodeType(nodeTypeName);\n                    const nodeTypeLabel = nodeType ? i18nRegistry.translate(nodeType.label) : nodeTypeName;\n                    return nodeType ? (\n                        <Button\n                            key={nodeTypeName}\n                            className={style.addNextNodeButton}\n                            disabled={!isAllowedToAddChildOrSiblingNodes}\n                            onClick={() => handleCommenceNodeCreation(nodeTypeName)}\n                            title={i18nRegistry.translate('Shel.Neos.Next.Node:Main:AddNextNode', `Create \"${nodeTypeLabel}\" as next element`, { nodeTypeLabel })}\n                        >\n                            <span className=\"fa-layers fa-fw\">\n                                <Icon\n                                    icon={nodeType.ui?.icon || 'plus'}\n                                    hoverStyle=\"brand\"\n                                    size=\"lg\"\n                                />\n                                <Icon icon=\"circle\" color=\"primaryBlue\" transform=\"shrink-3 down-10 right-10\" />\n                                <Icon icon=\"plus\" transform=\"shrink-7 down-10 right-10\" />\n                            </span>\n                        </Button>\n                    ) : null;\n                })}\n            </div>\n        ) : null;\n    };\n\n    return withReduxState(withPermissionContext(AddNextNodeToolBar as any));\n};\n\nexport default makeAddNextNodeToolbar;\n", "export const CREATE_NEXT_NODE_EVENT = 'shelNeosNextNode:createFirstCandidate';\n\nexport function triggerCreateFirstCandidateEvent() {\n    const guestFrame = window.document.querySelector('[name=\"neos-content-main\"]');\n    if (guestFrame && guestFrame.contentWindow) {\n        guestFrame.contentWindow.dispatchEvent(new CustomEvent(CREATE_NEXT_NODE_EVENT));\n    }\n}\n", ".addNextNodeButtons {\n    display: flex;\n    float: left;\n    border-right: 1px solid #3f3f3f;\n\n    &:not(:first-child) {\n        border-left: 1px solid #3f3f3f;\n    }\n}\n\n.addNextNodeButton {\n    padding-left: 0;\n    padding-right: 0;\n}\n", "import { triggerCreateFirstCandidateEvent } from './Events';\n\nexport default function CKEditorPlugin(editor) {\n    // Define Ctrl+Enter keystroke to trigger next node creation from inside the inline editor\n    editor.keystrokes.set('Ctrl+Enter', (event, cancel) => {\n        triggerCreateFirstCandidateEvent();\n        cancel();\n        // Return false to ensure the event is fully handled\n        return false;\n    });\n}\n", "import { createAction } from 'redux-actions';\nimport { triggerCreateFirstCandidateEvent } from '../features/Events';\n\nexport const actionTypes = {\n    CREATE_NEXT_NODE: 'CREATE_NEXT_NODE',\n};\n\nconst createNextNode = createAction(actionTypes.CREATE_NEXT_NODE, () => {\n    triggerCreateFirstCandidateEvent();\n});\n\nexport const actions = {\n    createNextNode,\n};\n", "import manifest from '@neos-project/neos-ui-extensibility';\n\nimport makeNextNodeToolbar from './features/AddNextNodeToolBar';\nimport CKEditorPlugin from './features/CKEditorPlugin';\nimport { actions } from './actions';\n\nmanifest('Shel.Neos.Next.Node:ToolBar', {}, (globalRegistry, { frontendConfiguration }) => {\n    const guestFrameRegistry = globalRegistry.get('@neos-project/neos-ui-guest-frame');\n    const ckEditorRegistry = globalRegistry.get('ckEditor5');\n    const pluginConfiguration = frontendConfiguration['Shel.Neos.Next.Node:ToolBar'];\n\n    // Create and register the toolbar component\n    const Toolbar = makeNextNodeToolbar(pluginConfiguration);\n    guestFrameRegistry.set('NodeToolbar/Buttons/AddNextNodeToolBar', Toolbar, 'before AddNode');\n\n    // Register CKEditor plugin which provides the hotkey inside the inline editing mode\n    const config = ckEditorRegistry.get('config');\n    config.set('nextNode', (config) => {\n        config.plugins = config.plugins || [];\n        config.plugins.push(CKEditorPlugin);\n        return config;\n    });\n\n    // Register hotkeys to trigger next node creation from anywhere in the UI\n    globalRegistry.get('hotkeys').set('Shel.Neos.Next.Node:createPrimary', {\n        description: 'Create next node',\n        action: actions.createNextNode,\n    });\n    globalRegistry.get('hotkeys').set('Shel.Neos.Next.Node:createSecondary', {\n        description: 'Create next node',\n        action: actions.createNextNode,\n    });\n});\n"],
  "mappings": "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",
  "names": ["readFromConsumerApi", "key", "args", "init_readFromConsumerApi", "__esmMin", "require_react", "__commonJSMin", "exports", "module", "init_readFromConsumerApi", "readFromConsumerApi", "require_react_redux", "__commonJSMin", "exports", "module", "init_readFromConsumerApi", "readFromConsumerApi", "require_neos_ui_redux_store", "__commonJSMin", "exports", "module", "init_readFromConsumerApi", "readFromConsumerApi", "require_react_ui_components", "__commonJSMin", "exports", "module", "init_readFromConsumerApi", "readFromConsumerApi", "require_neos_ui_decorators", "__commonJSMin", "exports", "module", "init_readFromConsumerApi", "readFromConsumerApi", "require_redux_actions", "__commonJSMin", "exports", "module", "init_readFromConsumerApi", "readFromConsumerApi", "init_readFromConsumerApi", "dist_default", "readFromConsumerApi", "import_react", "import_react_redux", "import_neos_ui_redux_store", "import_react_ui_components", "import_neos_ui_decorators", "CREATE_NEXT_NODE_EVENT", "triggerCreateFirstCandidateEvent", "guestFrame", "AddNextNodeToolBar_default", "addNextNodeButtons", "addNextNodeButton", "withReduxState", "state", "withNeosGlobals", "globalRegistry", "withPermissionContext", "component", "_state", "nodeTypesRegistry", "getAllowedSiblingNodeTypesSelector", "focusedNodeContextPath", "focusedNode", "role", "allowedSiblingNodeTypes", "makeAddNextNodeToolbar", "pluginConfiguration", "contextPath", "fusionPath", "commenceNodeCreation", "isAllowedToAddChildOrSiblingNodes", "i18nRegistry", "node", "nextNodeTypes", "nodeType", "nextNodeTypeCandidates", "nodeTypeName", "handleCommenceNodeCreation", "contentWindow", "createFirstCandidateListener", "e", "CREATE_NEXT_NODE_EVENT", "React", "AddNextNodeToolBar_default", "nodeTypeLabel", "CKEditorPlugin", "editor", "event", "cancel", "triggerCreateFirstCandidateEvent", "import_redux_actions", "actionTypes", "createNextNode", "triggerCreateFirstCandidateEvent", "actions", "dist_default", "globalRegistry", "frontendConfiguration", "guestFrameRegistry", "ckEditorRegistry", "pluginConfiguration", "Toolbar", "AddNextNodeToolBar_default", "config", "CKEditorPlugin", "actions"]
}
