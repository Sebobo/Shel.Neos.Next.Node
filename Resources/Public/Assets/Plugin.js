(()=>{var ee=Object.create;var O=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var oe=Object.getOwnPropertyNames;var re=Object.getPrototypeOf,ne=Object.prototype.hasOwnProperty;var se=(e,t)=>()=>(e&&(t=e(e=0)),t);var y=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ie=(e,t,r,l)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of oe(t))!ne.call(e,a)&&a!==r&&O(e,a,{get:()=>t[a],enumerable:!(l=te(t,a))||l.enumerable});return e};var N=(e,t,r)=>(r=e!=null?ee(re(e)):{},ie(t||!e||!e.__esModule?O(r,"default",{value:e,enumerable:!0}):r,e));function n(e){return(...t)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${e}`])return window["@Neos:HostPluginAPI"][`@${e}`](...t);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var p=se(()=>{});var K=y((De,B)=>{p();B.exports=n("NeosProjectPackages")().NeosUiGuestFrameDom});var S=y((Le,W)=>{p();W.exports=n("vendor")().React});var D=y((He,j)=>{p();j.exports=n("vendor")().reactRedux});var L=y((ze,M)=>{p();M.exports=n("NeosProjectPackages")().NeosUiReduxStore});var H=y((Xe,U)=>{p();U.exports=n("NeosProjectPackages")().ReactUiComponents});var z=y((qe,V)=>{p();V.exports=n("NeosProjectPackages")().NeosUiDecorators});var Y=y((at,q)=>{p();q.exports=n("vendor")().reduxActions});p();var I=n("manifest");var Q=N(K());var d=N(S()),_=N(D()),c=N(L()),b=N(H()),X=N(z());var T="shelNeosNextNode:createFirstCandidate";function P(){let e=window.document.querySelector('[name="neos-content-main"]');e&&e.contentWindow&&e.contentWindow.dispatchEvent(new CustomEvent(T))}var v={addNextNodeButtons:"f",addNextNodeButton:"d"};var x=N(S());function G(e){let t=(0,x.useRef)(e);return(0,x.useEffect)(()=>{t.current=e}),(0,x.useCallback)((r,l)=>t.current&&t.current(r,l),[])}var ce=(0,_.connect)(e=>({node:c.selectors.CR.Nodes.focusedSelector(e),getNodeByContextPath:c.selectors.CR.Nodes.nodeByContextPath(e),inspectorIsDirty:c.selectors.UI.Inspector.isDirty(e)}),{focusNode:c.actions.CR.Nodes.focus,moveNodes:c.actions.CR.Nodes.moveMultiple}),le=(0,X.neos)(e=>({nodeTypesRegistry:e.get("@neos-project/neos-ui-contentrepository")})),ue=e=>le((0,_.connect)((t,{nodeTypesRegistry:r})=>{let l=c.selectors.CR.Nodes.makeGetAllowedSiblingNodeTypesSelector(r);return a=>{let C=c.selectors.CR.Nodes.focusedNodePathSelector(a),m=c.selectors.CR.Nodes.makeGetNodeByContextPathSelector(C)(a),s=m?r.hasRole(m.nodeType,"document")?"document":"content":null,g=m?l(a,{reference:C,role:s}):[];return{allowedSiblingNodeTypes:g,isAllowedToAddChildOrSiblingNodes:g.length>0}}},{commenceNodeCreation:c.actions.CR.Nodes.commenceCreation})(e)),fe=e=>ce(ue(({contextPath:r,fusionPath:l,commenceNodeCreation:a,isAllowedToAddChildOrSiblingNodes:C,allowedSiblingNodeTypes:E,i18nRegistry:m,node:s,nodeTypesRegistry:g,inspectorIsDirty:A})=>{let w=(0,d.useMemo)(()=>{let o=s?g.getNodeType(s.nodeType):[],{nextNodeTypes:u}=o.options,i=u?Object.keys(u).filter(f=>u[f]&&E.includes(f)):[];return i.length>0?i:e.currentNodeTypeAsFallback?[s.nodeType]:[]},[s?.nodeType,E]),h=G(o=>!A&&a(r,l,"after",o));return(0,d.useEffect)(()=>{let o=document.querySelector('[name="neos-content-main"]')?.contentWindow;if(s.isAutoCreated||!o)return;let u=i=>{let f=w.length>0?w[0]:null;i.type===T&&h(f),i.key==="Enter"&&(i.metaKey||i.ctrlKey)&&(i.stopImmediatePropagation(),i.preventDefault(),h(f))};return o.addEventListener(T,u),o.addEventListener("keydown",u,!0),()=>{o.removeEventListener(T,u),o.removeEventListener("keydown",u,!0)}},[r,h]),s.isAutoCreated?null:d.default.createElement("div",{className:v.addNextNodeButtons,id:"neos-InlineToolbar-AddNextNode"},w.map((o,u)=>{let i=g.getNodeType(o),f=i?m.translate(i.label):o,Z=u===0?m.translate("Shel.Neos.Next.Node:Main:AddPrimaryNextNode",`Create "${f}" as next element (Ctrl+Enter | Cmd + Enter)`,{nodeTypeLabel:f}):m.translate("Shel.Neos.Next.Node:Main:AddNextNode",`Create "${f}" as next element`,{nodeTypeLabel:f});return i?d.default.createElement(b.Button,{key:o,className:v.addNextNodeButton,disabled:!C,onClick:()=>h(o),title:Z},d.default.createElement("span",{className:"fa-layers fa-fw"},d.default.createElement(b.Icon,{icon:i.ui?.icon||"plus",hoverStyle:"brand",size:"lg"}),d.default.createElement(b.Icon,{icon:"circle",color:"primaryBlue",transform:"shrink-3 down-10 right-10"}),d.default.createElement(b.Icon,{icon:"plus",transform:"shrink-7 down-10 right-10"}))):null}))})),$=fe;function k(e){e.keystrokes.set("Ctrl+Enter",(t,r)=>(P(),r(),!1))}var J=N(Y());var pe={CREATE_NEXT_NODE:"CREATE_NEXT_NODE"},me=(0,J.createAction)(pe.CREATE_NEXT_NODE,()=>{P()}),R={createNextNode:me};I("Shel.Neos.Next.Node:ToolBar",{},(e,{frontendConfiguration:t})=>{let r=e.get("@neos-project/neos-ui-guest-frame"),l=e.get("ckEditor5"),a=e.get("serverFeedbackHandlers"),C=t["Shel.Neos.Next.Node:ToolBar"],E=$(C);r.set("NodeToolbar/Buttons/AddNextNodeToolBar",E,"before AddNode"),l.get("config").set("nextNode",s=>(s.plugins=s.plugins||[],s.plugins.push(k),s)),e.get("hotkeys").set("Shel.Neos.Next.Node:createPrimary",{description:"Create next node",action:R.createNextNode}),e.get("hotkeys").set("Shel.Neos.Next.Node:createSecondary",{description:"Create next node",action:R.createNextNode}),a.set("Neos.Neos.Ui:RenderContentOutOfBand/NextNode",async s=>{let{contextPath:g,parentDomAddress:A}=s,h=(A&&(0,Q.findNodeInGuestFrame)(A.contextPath,A.fusionPath)).querySelector(`[data-__neos-node-contextpath="${g}"]`);if(h){let o=h.querySelector("[data-neos-inline-editor-is-initialized]");if(!o)return;setTimeout(()=>{o.focus(),console.debug("Focusing first initialized editable in the new node",o)},10)}},"after Main")});})();
//# sourceMappingURL=Plugin.js.map
