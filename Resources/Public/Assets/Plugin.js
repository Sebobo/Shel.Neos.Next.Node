(()=>{var J=Object.create;var v=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var ee=Object.getPrototypeOf,te=Object.prototype.hasOwnProperty;var oe=(e,t)=>()=>(e&&(t=e(e=0)),t);var h=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var re=(e,t,n,u)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Z(t))!te.call(e,i)&&i!==n&&v(e,i,{get:()=>t[i],enumerable:!(u=Q(t,i))||u.enumerable});return e};var y=(e,t,n)=>(n=e!=null?J(ee(e)):{},re(t||!e||!e.__esModule?v(n,"default",{value:e,enumerable:!0}):n,e));function r(e){return(...t)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${e}`])return window["@Neos:HostPluginAPI"][`@${e}`](...t);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var p=oe(()=>{});var k=h((We,R)=>{p();R.exports=r("NeosProjectPackages")().NeosUiGuestFrameDom});var I=h((Ke,B)=>{p();B.exports=r("vendor")().React});var j=h((Me,W)=>{p();W.exports=r("vendor")().reactRedux});var D=h((He,K)=>{p();K.exports=r("NeosProjectPackages")().NeosUiReduxStore});var L=h((Ve,M)=>{p();M.exports=r("NeosProjectPackages")().ReactUiComponents});var U=h((Ge,H)=>{p();H.exports=r("NeosProjectPackages")().NeosUiDecorators});var X=h((tt,G)=>{p();G.exports=r("vendor")().reduxActions});p();var F=r("manifest");var q=y(k());var c=y(I()),P=y(j()),f=y(D()),C=y(L()),V=y(U());var A="shelNeosNextNode:createFirstCandidate";function w(){let e=window.document.querySelector('[name="neos-content-main"]');e&&e.contentWindow&&e.contentWindow.dispatchEvent(new CustomEvent(A))}var T={addNextNodeButtons:"f",addNextNodeButton:"d"};var ie=(0,P.connect)(e=>({node:f.selectors.CR.Nodes.focusedSelector(e),getNodeByContextPath:f.selectors.CR.Nodes.nodeByContextPath(e)}),{focusNode:f.actions.CR.Nodes.focus,moveNodes:f.actions.CR.Nodes.moveMultiple}),ae=(0,V.neos)(e=>({nodeTypesRegistry:e.get("@neos-project/neos-ui-contentrepository")})),de=e=>ae((0,P.connect)((t,{nodeTypesRegistry:n})=>{let u=f.selectors.CR.Nodes.makeGetAllowedSiblingNodeTypesSelector(n);return i=>{let x=f.selectors.CR.Nodes.focusedNodePathSelector(i),m=f.selectors.CR.Nodes.makeGetNodeByContextPathSelector(x)(i),s=m?n.hasRole(m.nodeType,"document")?"document":"content":null,N=m?u(i,{reference:x,role:s}):[];return{allowedSiblingNodeTypes:N,isAllowedToAddChildOrSiblingNodes:N.length>0}}},{commenceNodeCreation:f.actions.CR.Nodes.commenceCreation})(e)),ce=e=>ie(de(({contextPath:n,fusionPath:u,commenceNodeCreation:i,isAllowedToAddChildOrSiblingNodes:x,allowedSiblingNodeTypes:E,i18nRegistry:m,node:s,nodeTypesRegistry:N})=>{let g=(0,c.useMemo)(()=>{let o=s?N.getNodeType(s.nodeType):[],{nextNodeTypes:a}=o.options,d=a?Object.keys(a).filter(l=>a[l]&&E.includes(l)):[];return d.length>0?d:e.currentNodeTypeAsFallback?[s.nodeType]:[]},[s?.nodeType,E]),b=(0,c.useCallback)(o=>{i(n,u,"after",o)},[n,u,i]);return(0,c.useEffect)(()=>{let o=document.querySelector('[name="neos-content-main"]')?.contentWindow;if(s.isAutoCreated||!o)return;let a=d=>{let l=g.length>0?g[0]:null;d.type===A&&b(l),d.key==="Enter"&&(d.metaKey||d.ctrlKey)&&(d.stopImmediatePropagation(),d.preventDefault(),b(l))};return o.addEventListener(A,a),o.addEventListener("keydown",a,!0),()=>{o.removeEventListener(A,a),o.removeEventListener("keydown",a,!0)}},[n,b]),s.isAutoCreated?null:c.default.createElement("div",{className:T.addNextNodeButtons,id:"neos-InlineToolbar-AddNextNode"},g.map((o,a)=>{let d=N.getNodeType(o),l=d?m.translate(d.label):o,Y=a===0?m.translate("Shel.Neos.Next.Node:Main:AddPrimaryNextNode",`Create "${l}" as next element (Ctrl+Enter | Cmd + Enter)`,{nodeTypeLabel:l}):m.translate("Shel.Neos.Next.Node:Main:AddNextNode",`Create "${l}" as next element`,{nodeTypeLabel:l});return d?c.default.createElement(C.Button,{key:o,className:T.addNextNodeButton,disabled:!x,onClick:()=>b(o),title:Y},c.default.createElement("span",{className:"fa-layers fa-fw"},c.default.createElement(C.Icon,{icon:d.ui?.icon||"plus",hoverStyle:"brand",size:"lg"}),c.default.createElement(C.Icon,{icon:"circle",color:"primaryBlue",transform:"shrink-3 down-10 right-10"}),c.default.createElement(C.Icon,{icon:"plus",transform:"shrink-7 down-10 right-10"}))):null}))})),z=ce;function S(e){e.keystrokes.set("Ctrl+Enter",(t,n)=>(w(),n(),!1))}var $=y(X());var le={CREATE_NEXT_NODE:"CREATE_NEXT_NODE"},fe=(0,$.createAction)(le.CREATE_NEXT_NODE,()=>{w()}),_={createNextNode:fe};F("Shel.Neos.Next.Node:ToolBar",{},(e,{frontendConfiguration:t})=>{let n=e.get("@neos-project/neos-ui-guest-frame"),u=e.get("ckEditor5"),i=e.get("serverFeedbackHandlers"),x=t["Shel.Neos.Next.Node:ToolBar"],E=z(x);n.set("NodeToolbar/Buttons/AddNextNodeToolBar",E,"before AddNode"),u.get("config").set("nextNode",s=>(s.plugins=s.plugins||[],s.plugins.push(S),s)),e.get("hotkeys").set("Shel.Neos.Next.Node:createPrimary",{description:"Create next node",action:_.createNextNode}),e.get("hotkeys").set("Shel.Neos.Next.Node:createSecondary",{description:"Create next node",action:_.createNextNode}),i.set("Neos.Neos.Ui:RenderContentOutOfBand/NextNode",async s=>{let{contextPath:N,parentDomAddress:g}=s,o=(g&&(0,q.findNodeInGuestFrame)(g.contextPath,g.fusionPath)).querySelector(`[data-__neos-node-contextpath="${N}"]`);if(o){let a=o.querySelector("[data-neos-inline-editor-is-initialized]");if(!a)return;setTimeout(()=>{a.focus(),console.debug("Focusing first initialized editable in the new node",a)},10)}},"after Main")});})();
//# sourceMappingURL=Plugin.js.map
