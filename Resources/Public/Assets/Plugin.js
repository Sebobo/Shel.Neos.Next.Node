(()=>{var ee=Object.create;var k=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var oe=Object.getOwnPropertyNames;var re=Object.getPrototypeOf,ne=Object.prototype.hasOwnProperty;var se=(e,t)=>()=>(e&&(t=e(e=0)),t);var y=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ie=(e,t,o,l)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of oe(t))!ne.call(e,a)&&a!==o&&k(e,a,{get:()=>t[a],enumerable:!(l=te(t,a))||l.enumerable});return e};var N=(e,t,o)=>(o=e!=null?ee(re(e)):{},ie(t||!e||!e.__esModule?k(o,"default",{value:e,enumerable:!0}):o,e));function n(e){return(...t)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${e}`])return window["@Neos:HostPluginAPI"][`@${e}`](...t);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var p=se(()=>{});var K=y((Le,B)=>{p();B.exports=n("NeosProjectPackages")().NeosUiGuestFrameDom});var P=y((He,W)=>{p();W.exports=n("vendor")().React});var D=y((ze,j)=>{p();j.exports=n("vendor")().reactRedux});var L=y((Xe,M)=>{p();M.exports=n("NeosProjectPackages")().NeosUiReduxStore});var H=y((qe,U)=>{p();U.exports=n("NeosProjectPackages")().ReactUiComponents});var z=y((Ze,V)=>{p();V.exports=n("NeosProjectPackages")().NeosUiDecorators});var Y=y((dt,q)=>{p();q.exports=n("vendor")().reduxActions});p();var I=n("manifest");var J=N(K());var d=N(P()),_=N(D()),c=N(L()),E=N(H()),X=N(z());var T="shelNeosNextNode:createFirstCandidate";function w(){let e=window.document.querySelector('[name="neos-content-main"]');e&&e.contentWindow&&e.contentWindow.dispatchEvent(new CustomEvent(T))}var v={addNextNodeButtons:"f",addNextNodeButton:"d"};var x=N(P());function G(e){let t=(0,x.useRef)(e);return(0,x.useEffect)(()=>{t.current=e}),(0,x.useCallback)((o,l)=>t.current&&t.current(o,l),[])}var ce=(0,_.connect)(e=>({node:c.selectors.CR.Nodes.focusedSelector(e),getNodeByContextPath:c.selectors.CR.Nodes.nodeByContextPath(e),inspectorIsDirty:c.selectors.UI.Inspector.isDirty(e)}),{focusNode:c.actions.CR.Nodes.focus,moveNodes:c.actions.CR.Nodes.moveMultiple}),le=(0,X.neos)(e=>({nodeTypesRegistry:e.get("@neos-project/neos-ui-contentrepository")})),fe=parseInt(CKEDITOR_VERSION)>=47,ue=fe?"small":"regular",pe=e=>le((0,_.connect)((t,{nodeTypesRegistry:o})=>{let l=c.selectors.CR.Nodes.makeGetAllowedSiblingNodeTypesSelector(o);return a=>{let C=c.selectors.CR.Nodes.focusedNodePathSelector(a),m=c.selectors.CR.Nodes.makeGetNodeByContextPathSelector(C)(a),s=m?o.hasRole(m.nodeType,"document")?"document":"content":null,g=m?l(a,{reference:C,role:s}):[];return{allowedSiblingNodeTypes:g,isAllowedToAddChildOrSiblingNodes:g.length>0}}},{commenceNodeCreation:c.actions.CR.Nodes.commenceCreation})(e)),me=e=>ce(pe(({contextPath:o,fusionPath:l,commenceNodeCreation:a,isAllowedToAddChildOrSiblingNodes:C,allowedSiblingNodeTypes:b,i18nRegistry:m,node:s,nodeTypesRegistry:g,inspectorIsDirty:A})=>{let S=(0,d.useMemo)(()=>{let r=s?g.getNodeType(s.nodeType):[],{nextNodeTypes:f}=r.options,i=f?Object.keys(f).filter(u=>f[u]&&b.includes(u)):[];return i.length>0?i:e.currentNodeTypeAsFallback?[s.nodeType]:[]},[s?.nodeType,b]),h=G(r=>!A&&a(o,l,"after",r));return(0,d.useEffect)(()=>{let r=document.querySelector('[name="neos-content-main"]')?.contentWindow;if(s.isAutoCreated||!r)return;let f=i=>{let u=S.length>0?S[0]:null;i.type===T&&h(u),i.key==="Enter"&&(i.metaKey||i.ctrlKey)&&(i.stopImmediatePropagation(),i.preventDefault(),h(u))};return r.addEventListener(T,f),r.addEventListener("keydown",f,!0),()=>{r.removeEventListener(T,f),r.removeEventListener("keydown",f,!0)}},[o,h]),s.isAutoCreated?null:d.default.createElement("div",{className:v.addNextNodeButtons,id:"neos-InlineToolbar-AddNextNode"},S.map((r,f)=>{let i=g.getNodeType(r),u=i?m.translate(i.label):r,Q=f===0?m.translate("Shel.Neos.Next.Node:Main:AddPrimaryNextNode",`Create "${u}" as next element (Ctrl+Enter | Cmd + Enter)`,{nodeTypeLabel:u}):m.translate("Shel.Neos.Next.Node:Main:AddNextNode",`Create "${u}" as next element`,{nodeTypeLabel:u});return i?d.default.createElement(E.Button,{key:r,className:v.addNextNodeButton,disabled:!C,onClick:()=>h(r),title:Q,size:ue},d.default.createElement("span",{className:"fa-layers fa-fw"},d.default.createElement(E.Icon,{icon:i.ui?.icon||"plus",hoverStyle:"brand",size:"lg"}),d.default.createElement(E.Icon,{icon:"circle",color:"primaryBlue",transform:"shrink-3 down-10 right-10"}),d.default.createElement(E.Icon,{icon:"plus",transform:"shrink-7 down-10 right-10"}))):null}))})),$=me;function O(e){e.keystrokes.set("Ctrl+Enter",(t,o)=>(w(),o(),!1))}var Z=N(Y());var Ne={CREATE_NEXT_NODE:"CREATE_NEXT_NODE"},ge=(0,Z.createAction)(Ne.CREATE_NEXT_NODE,()=>{w()}),R={createNextNode:ge};I("Shel.Neos.Next.Node:ToolBar",{},(e,{frontendConfiguration:t})=>{let o=e.get("@neos-project/neos-ui-guest-frame"),l=e.get("ckEditor5"),a=e.get("serverFeedbackHandlers"),C=t["Shel.Neos.Next.Node:ToolBar"],b=$(C);o.set("NodeToolbar/Buttons/AddNextNodeToolBar",b,"before AddNode"),l.get("config").set("nextNode",s=>(s.plugins=s.plugins||[],s.plugins.push(O),s)),e.get("hotkeys").set("Shel.Neos.Next.Node:createPrimary",{description:"Create next node",action:R.createNextNode}),e.get("hotkeys").set("Shel.Neos.Next.Node:createSecondary",{description:"Create next node",action:R.createNextNode}),a.set("Neos.Neos.Ui:RenderContentOutOfBand/NextNode",async s=>{let{contextPath:g,parentDomAddress:A}=s,h=(A&&(0,J.findNodeInGuestFrame)(A.contextPath,A.fusionPath)).querySelector(`[data-__neos-node-contextpath="${CSS.escape(g)}"]`);if(h){let r=h.querySelector("[data-neos-inline-editor-is-initialized]");if(!r)return;setTimeout(()=>{r.focus()},10)}},"after Main")});})();
//# sourceMappingURL=Plugin.js.map
