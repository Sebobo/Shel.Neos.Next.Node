(()=>{var $=Object.create;var R=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var Y=Object.getPrototypeOf,J=Object.prototype.hasOwnProperty;var Q=(e,t)=>()=>(e&&(t=e(e=0)),t);var g=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Z=(e,t,o,f)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of z(t))!J.call(e,n)&&n!==o&&R(e,n,{get:()=>t[n],enumerable:!(f=q(t,n))||f.enumerable});return e};var N=(e,t,o)=>(o=e!=null?$(Y(e)):{},Z(t||!e||!e.__esModule?R(o,"default",{value:e,enumerable:!0}):o,e));function r(e){return(...t)=>{if(window["@Neos:HostPluginAPI"]&&window["@Neos:HostPluginAPI"][`@${e}`])return window["@Neos:HostPluginAPI"][`@${e}`](...t);throw new Error("You are trying to read from a consumer api that hasn't been initialized yet!")}}var p=Q(()=>{});var F=g((ke,k)=>{p();k.exports=r("vendor")().React});var W=g((Be,B)=>{p();B.exports=r("vendor")().reactRedux});var j=g((Ie,I)=>{p();I.exports=r("NeosProjectPackages")().NeosUiReduxStore});var D=g((Ke,K)=>{p();K.exports=r("NeosProjectPackages")().ReactUiComponents});var M=g((Le,L)=>{p();L.exports=r("NeosProjectPackages")().NeosUiDecorators});var H=g((ze,X)=>{p();X.exports=r("vendor")().reduxActions});p();var O=r("manifest");var a=N(F()),T=N(W()),l=N(j()),h=N(D()),V=N(M());var C="shelNeosNextNode:createFirstCandidate";function A(){let e=window.document.querySelector('[name="neos-content-main"]');e&&e.contentWindow&&e.contentWindow.dispatchEvent(new CustomEvent(C))}var w={addNextNodeButtons:"f",addNextNodeButton:"d"};var oe=(0,T.connect)(e=>({node:l.selectors.CR.Nodes.focusedSelector(e),getNodeByContextPath:l.selectors.CR.Nodes.nodeByContextPath(e)}),{focusNode:l.actions.CR.Nodes.focus,moveNodes:l.actions.CR.Nodes.moveMultiple}),re=(0,V.neos)(e=>({nodeTypesRegistry:e.get("@neos-project/neos-ui-contentrepository")})),ne=e=>re((0,T.connect)((t,{nodeTypesRegistry:o})=>{let f=l.selectors.CR.Nodes.makeGetAllowedSiblingNodeTypesSelector(o);return n=>{let m=l.selectors.CR.Nodes.focusedNodePathSelector(n),c=l.selectors.CR.Nodes.makeGetNodeByContextPathSelector(m)(n),u=c?o.hasRole(c.nodeType,"document")?"document":"content":null,y=c?f(n,{reference:m,role:u}):[];return{allowedSiblingNodeTypes:y,isAllowedToAddChildOrSiblingNodes:y.length>0}}},{commenceNodeCreation:l.actions.CR.Nodes.commenceCreation})(e)),se=e=>oe(ne(({contextPath:o,fusionPath:f,commenceNodeCreation:n,isAllowedToAddChildOrSiblingNodes:m,allowedSiblingNodeTypes:x,i18nRegistry:c,node:u,nodeTypesRegistry:y})=>{let E=(0,a.useMemo)(()=>{let s=u?y.getNodeType(u.nodeType):[],{nextNodeTypes:i}=s.options,d=i?Object.keys(i).filter(_=>i[_]&&x.includes(_)):[];return d.length>0?d:[u.nodeType]},[u?.nodeType,x]),b=(0,a.useCallback)(s=>{n(o,f,"after",s)},[o,f,n]);return(0,a.useEffect)(()=>{let s=document.querySelector('[name="neos-content-main"]')?.contentWindow;if(u.isAutoCreated||!s)return;let i=d=>{E.length!==0&&(d.type===C&&b(E[0]),d.key==="Enter"&&(d.metaKey||d.ctrlKey)&&(d.stopImmediatePropagation(),d.preventDefault(),b(E[0])))};return s.addEventListener(C,i),s.addEventListener("keydown",i,!0),()=>{s.removeEventListener(C,i),s.removeEventListener("keydown",i,!0)}},[o,b]),u.isAutoCreated?null:a.default.createElement("div",{className:w.addNextNodeButtons,id:"neos-InlineToolbar-AddNextNode"},E.map(s=>{let i=y.getNodeType(s),d=i?c.translate(i.label):s;return i?a.default.createElement(h.Button,{key:s,className:w.addNextNodeButton,disabled:!m,onClick:()=>b(s),title:c.translate("Shel.Neos.Next.Node:Main:AddNextNode",`Create "${d}" as next element`,{nodeTypeLabel:d})},a.default.createElement("span",{className:"fa-layers fa-fw"},a.default.createElement(h.Icon,{icon:i.ui?.icon||"plus",hoverStyle:"brand",size:"lg"}),a.default.createElement(h.Icon,{icon:"circle",color:"primaryBlue",transform:"shrink-3 down-10 right-10"}),a.default.createElement(h.Icon,{icon:"plus",transform:"shrink-7 down-10 right-10"}))):null}))})),U=se;function S(e){e.keystrokes.set("Ctrl+Enter",(t,o)=>(A(),o(),!1))}var G=N(H());var ie={CREATE_NEXT_NODE:"CREATE_NEXT_NODE"},ae=(0,G.createAction)(ie.CREATE_NEXT_NODE,()=>{A()}),P={createNextNode:ae};O("Shel.Neos.Next.Node:ToolBar",{},(e,{frontendConfiguration:t})=>{let o=e.get("@neos-project/neos-ui-guest-frame"),f=e.get("ckEditor5"),n=t["Shel.Neos.Next.Node:ToolBar"],m=U(n);o.set("NodeToolbar/Buttons/AddNextNodeToolBar",m,"before AddNode"),f.get("config").set("nextNode",c=>(c.plugins=c.plugins||[],c.plugins.push(S),c)),e.get("hotkeys").set("Shel.Neos.Next.Node:createPrimary",{description:"Create next node",action:P.createNextNode}),e.get("hotkeys").set("Shel.Neos.Next.Node:createSecondary",{description:"Create next node",action:P.createNextNode})});})();
//# sourceMappingURL=Plugin.js.map
